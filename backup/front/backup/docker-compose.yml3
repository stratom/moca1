version: "3.9"

services:
  oracle-python-app:
    image: oraclelinux:8
    container_name: frontendai
    restart: unless-stopped
    volumes:
      - ~/.oci:/root/.oci  # OCI config y key
      - ~/moca/dbai:/app/backend
      - ~/moca/front:/app/frontendai
      - /home/opc/moca1/opt/vector-ai/source:/home/opc/moca1/opt/vector-ai/source/
    working_dir: /app
    ports:
      - "5000:5000"
      - "8501:8501"  # Para Streamlit
    environment:
      - PYTHONUNBUFFERED=1
    command: >
      sh -c "
      dnf install -y python39 python39-pip libaio curl unzip git gcc &&
      curl -fsSL https://rpm.nodesource.com/setup_18.x | bash - &&
      dnf install -y nodejs &&
      alternatives --set python /usr/bin/python3.9 &&
      alternatives --set python3 /usr/bin/python3.9 &&
      python3 -m pip install --upgrade pip &&
      python3 -m pip install oci oracledb PyPDF2 flask langchain langchain-community langchain-core python-dotenv streamlit pandas requests &&
      cd /app/frontendai/api &&
      chmod +x start_pm2.sh &&
      ./start_pm2.sh &&
      echo 'âœ… Enviroment Ready..' &&
      tail -f /dev/null
      "

